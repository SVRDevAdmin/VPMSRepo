@model VPMS.Lib.Data.Models.Pets;
@inject IHttpContextAccessor httpContextaccessor
@using Microsoft.AspNetCore.Localization
@inject VPMSWeb.Interface.IResourcesLocalizer LangResources

@{
	ViewData["Title"] = "Patients Page";
	ViewBag.SelectedMenu = "patientsMenu";
}

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.3/html2pdf.bundle.min.js" integrity="sha512-YcsIPGdhPK4P/uRW6/sruonlYj+Q7UHWeKfTAkBW+g83NKM+jMJFJ4iAPfSnVp7BKD4dKMHmVSvICUbE/V1sSw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<style>
	.currentTab {
		background-color: dodgerblue !important;
		border: none !important;
	}

	.field-container {
		display: flex;
		flex-direction: column;
		margin-left: 1.5vw;
		margin-right: 1.5vw;
	}

	.formlabel {
		font-weight: bold;
		margin-bottom: 0.3vw;
		font-size: 1vw;
	}

	.inputField {
		border: 0.1vw solid;
		font-size: 1vw;
	}

	.halfSize {
		width: 36vw;
	}

	.quaterSize {
		width: 8.5vw;
	}

	/* circle-icon */
	#container {
		width: 1.6vw;
		height: 1.6vw;
		display: flex;
		background: transparent;
		border-radius: 2vw;
		color: blue;
		border: 0.15vw solid;
		font-size: 1.5vw;
		justify-content: center;
		align-items: center;
	}

	.table-content {
		height: 2vw;
	}

	.table-row-content {
		padding: 1vw 0;
	}

	table th:first-child {
		border-radius: 0.2vw 0 0 0.2vw;
	}

	table th:last-child {
		border-radius: 0 0.2vw 0.2vw 0;
	}
</style>

<template id="treatmentPlanTemplate">
	<div class="textColor" style="border-style: dashed; border-radius: 1vw; padding: 1vw; font-size: 1vw; margin-right: 1vw;">
		<div style="display: flex; justify-content: space-between;">
			<div>
				<span id="treatmentPlanName" style="font-weight: bold;"></span>
			</div>
			<div style="display: flex; align-items: center;">
				<span style="color: red;">Pending Confirmation</span>
				<button class="btn btn-lg btn-primary" style="height: 2vw; width: 3vw; padding: 0; display: flex; justify-content: center; align-items: center; font-size: 1vw; margin-left: 0.5vw;"><i class="fa-solid fa-check"></i></button>
				<button onclick="removeTreatmentPlan(this);" class="btn btn-lg btn-danger" style="height: 2vw; width: 3vw; padding: 0; display: flex; justify-content: center; align-items: center; font-size: 1vw; margin-left: 0.5vw;"><i class="fa-solid fa-xmark"></i></button>
				<button class="btn btn-lg btn-secondary" style="height: 2vw; width: 3vw; padding: 0; display: flex; justify-content: center; align-items: center; font-size: 1vw; margin-left: 0.5vw;"><i class="fa-regular fa-pen-to-square"></i></button>
			</div>
		</div>
		<span>@LangResources["Patient_Label_TreatmentPeriod"] : 10/04/2024 - 15/04/2024</span>

		<div style=" padding: 1vw; border-radius: 0.5vw; margin-top: 1vw;" class="containerBackground">
			<table class="textColor" id="serviceList" style="width:100%; font-size: 1vw;">
				<tr style="border-bottom-width: 0.1vw; border-color: darkgray;">
					<th class="table-content" style="padding-left: 0.5vw;"> @LangResources["MenuBar_Label_Service"] </th>
					<th class="table-content" style="width: 3vw; padding-right: 0.5vw;"> @LangResources["Patient_Label_Price"]</th>
				</tr>
				<tr>
					<th class="table-content" style="font-weight: bold; padding-left: 0.5vw;"> @LangResources["Patient_Label_TotalCost"] </th>
					<th class="table-content" style="font-weight: bold; width: 3vw; padding-right: 0.5vw;"> $0 </th>
				</tr>
			</table>
		</div>

		<div style=" padding: 1vw; border-radius: 0.5vw; margin-top: 1vw;" class="containerBackground">
			<table class="textColor" id="productList" style="width:100%; font-size: 1vw;">
				<tr style="border-bottom-width: 0.1vw; border-color: darkgray;">
					<th class="table-content" style="padding-left: 0.5vw;"> @LangResources["Patient_Label_Product"] </th>
					<th class="table-content"> @LangResources["Patient_Label_Unit"] </th>
					<th class="table-content" style="width: 3vw; padding-right: 0.5vw;"> @LangResources["Patient_Label_Price"]</th>
				</tr>
				<tr>
					<th class="table-content" style="font-weight: bold; padding-left: 0.5vw;"> @LangResources["Patient_Label_TotalCost"] </th>
					<th class="table-content">0</th>
					<th class="table-content" style="font-weight: bold; width: 3vw; padding-right: 0.5vw;"> $0 </th>
				</tr>
			</table>
		</div>

		<div style=" padding: 1vw; border-radius: 0.5vw; margin-top: 1vw;" class="containerBackground">
			<table class="textColor" id="totalList" style="width:100%; font-size: 1vw;">
				<tr style="border-bottom-width: 0.1vw; border-color: darkgray;">
					<th class="table-content" style="padding-left: 0.5vw;"> @LangResources["Patient_Label_Payment"] </th>
					<th class="table-content" style="width: 3vw; padding-right: 0.5vw;"> @LangResources["Patient_Label_Price"]</th>
				</tr>
				<tr>
					<th class="table-content" style="padding-left: 0.5vw;"> @LangResources["Patient_Label_TotalCost"] </th>
					<th class="table-content" id="totalCost" style="width: 3vw; padding-right: 0.5vw;"> $0 </th>
				</tr>
				<tr>
					<th class="table-content" style="padding-left: 0.5vw;"> @LangResources["Patient_Label_Tax"] 6% </th>
					<th class="table-content" id="tax" style="width: 3vw; padding-right: 0.5vw;"> $0 </th>
				</tr>
				<tr style="background-color: #c8dcfc; color: black;">
					<th class="table-content" style="font-weight: bold; padding-left: 0.5vw;"> @LangResources["Patient_Label_GrandTotal"] </th>
					<th class="table-content" id="grandTotal" style="font-weight: bold; width: 3vw; padding-right: 0.5vw;"> $0 </th>
				</tr>
			</table>
		</div>

	</div>
</template>

<template id="serviceTemplate">
	<tr>
		<th class="table-content serviceName" style="padding-left: 0.5vw;"></th>
		<th class="table-content servicePrice" style="width: 3vw; padding-right: 0.5vw;"></th>
	</tr>
	<tr>
		<th class="table-content" style="font-weight: bold; padding-left: 0.5vw;"> @LangResources["Patient_Label_TotalCost"] </th>
		<th class="table-content totalCost" style="font-weight: bold; width: 3vw; padding-right: 0.5vw;"></th>
	</tr>
</template>

<template id="productTemplate">
	<tr>
		<th class="table-content productName" style="padding-left: 0.5vw;"></th>
		<th class="table-content productUnit"></th>
		<th class="table-content productOriginalPrice" hidden></th>
		<th class="table-content productPrice" style="width: 3vw; padding-right: 0.5vw;"></th>
	</tr>
	<tr>
		<th class="table-content" style="font-weight: bold; padding-left: 0.5vw;"> @LangResources["Patient_Label_TotalCost"] </th>
		<th class="table-content"></th>
		<th class="table-content totalCost" style="font-weight: bold; width: 3vw; padding-right: 0.5vw;"></th>
	</tr>
</template>

<div style="display: flex;">

	<div style="display: flex; align-items: center; margin-bottom: 1.5vw;">
		<img id="imgBackArrow" style=" margin-right: 1vw; width: 1.5vw;" onclick="location.href='/Patients/PetProfile/View/@ViewBag.PatientID/@ViewData["PetName"]'" />
		<span class="textColor" style="font-size: 2vw;">@LangResources["Patient_Title_Patients"]</span>
		<span class="textColor" style="font-size: 2vw; margin-left:1vw; margin-right:1vw; font-weight: bold;"> &#62; </span>
		<span class="textColor" style="font-size: 2vw;">@LangResources["Patient_Title_PatientProfile"]</span>
		<span class="textColor" style="font-size: 2vw; margin-left:1vw; margin-right:1vw; font-weight: bold;"> &#62; </span>
		<span class="textColor" style="font-size: 2vw;">@ViewData["PetName"] @LangResources["Patient_Title_Profile"]</span>
		<span class="textColor" style="font-size: 2vw; margin-left:1vw; margin-right:1vw; font-weight: bold;"> &#62; </span>
		<span style="font-size: 2vw; color: dodgerblue;">@LangResources["Patient_Label_TreatmentPlan"]</span>
	</div>
</div>

<div style="display: flex; justify-content: center;">
	<div id="LeftInfoContainer" style="overflow: auto; height: 74vh; margin-right: 1vw; width: 51vw;">
		<div style="background-color: black; border-radius: 0.5vw; display: flex; justify-content: space-between; padding: 0.29vw; margin-right: 1vw;">
			<button class="btn btn-lg btn-primary tabButton currentTab" onclick="changeTab(this);" style="background-color: black; border: none; font-size: 1vw;">@LangResources["Patient_Button_CreateTreatmentPlan"]</button>
			<button class="btn btn-lg btn-primary tabButton" onclick="changeTab(this);" style="background-color: black; border: none; font-size: 1vw;">@LangResources["Patient_Button_UpcomingTreatment"]</button>
			<button class="btn btn-lg btn-primary tabButton" onclick="changeTab(this);" style="background-color: black; border: none; font-size: 1vw;">@LangResources["Patient_Button_OutgoingTreatment"]</button>
			<button class="btn btn-lg btn-primary tabButton" onclick="changeTab(this);" style="background-color: black; border: none; font-size: 1vw;">@LangResources["Patient_Button_PastTreatment"]</button>
		</div>

		<div style="margin-top: 2vw; display: flex; align-items: flex-start;">

			<div id="treatmentPlanList" class="dropright">
				<button class="btn btn-lg btn-primary" data-toggle="dropdown" aria-expanded="false" style="background-color: transparent; color: blue; border-style: none; display: flex; align-items: center; box-shadow: none;">
					<span id="container">+</span>
					<span style="font-size: 1.2vw; margin-left: 0.5vw;">@LangResources["Patient_Button_AddTreatment"]</span>
				</button>
				<div class="dropdown-menu containerBackground3" style="padding: 1vw; border: 0.1vw solid; border-radius: 0.3vw;">
					<div style="display: flex; border: 0.1vw solid; border-radius: 0.3vw; margin-bottom: 1vw; align-items: center; padding: 0 0.5vw; color: black; background-color: #f7f7f7; border-color: darkgray;">
						<i class="fa-solid fa-magnifying-glass" style="margin-right: 0.3vw; color: darkgray"></i>
						<input type="text" id="searchTreatment" placeholder="@LangResources["Patient_Label_SearchTreatment"]" onkeyup="filterTreatment(this);" style=" width: 100%; border: none; outline-width: 0; background-color: transparent;" />
					</div>
					<div style="height: 10vw; width: 23vw; overflow-y: auto; margin-bottom: 1vw; padding: 0 0.5vw;">

						<div style="margin-bottom: 1vw;">
							@{
								int indexNo = 1;
								string index = "";

								foreach (var treatmentPlan in ViewData["TreatmentPlans"] as List<VPMS.Lib.Data.Models.TreatmentPlanModel>)
								{
									index = "service" + indexNo;

												<div class="form-check">
													<input type="checkbox" class="form-check-input treatmentPlanOption" id="@index" name="@index" data-id="@treatmentPlan.ID" value="@treatmentPlan.Name">
													<label class="form-check-label" for="@index">@treatmentPlan.Name</label><br>
												</div>

									indexNo++;
								}
							}
						</div>
						
					</div>
					<div style="display: flex; justify-content: space-between; align-items: center;">
						<button class="btn btn-lg btn-primary" id="clearFilter" href="#" style="background-color: transparent; color: blue; border-style: none; box-shadow: none;">
							<span style="font-size: 1.2vw; margin-left: 0.5vw;">@LangResources["Patient_Button_ClearAll"]</span>
						</button>
						<button id="addSelections" class="btn btn-lg btn-primary disable" style="font-size: 1vw;">@LangResources["Patient_Button_AddSelections"]</button>
					</div>
				</div>
			</div>

			<div class ="hideContainer" id="treatmentPlanContainer" style="width: 100%;">
			</div>
			

		</div>
	</div>

	<div id="RightInfoContainer" style="margin-left: 1.5vw; overflow: auto; height: 74vh; width: 24vw;">
		<div>

			<div class="containerBackground2" style="width: 23vw; padding: 0.7vw; padding-left: 1.5vw; border-top-left-radius: 0.5vw; border-top-right-radius: 0.5vw;">
				<span class="formlabel" style="margin-bottom: 0 !important;">@LangResources["Patient_Title_PetInfo"]</span>
			</div>
			<div class="containerBorder" style="color: darkgray; width: 23vw; border-style: solid; border-bottom-left-radius: 0.5vw; border-bottom-right-radius: 0.5vw; padding: 2vw; padding-left: 1vw; padding-right: 1vw; padding-bottom: 0.5vw; margin-bottom: 2vw; display: flex;">

				<div>
					<img src="~/images/Cat profile image.png" style="width: 4vw;" />
				</div>

				<div>
					<div style="display: flex; margin-bottom: 1.5vw;">
						<div class="field-container quaterSize">
							<span class="formlabel">@LangResources["Patient_Label_PetName"]</span>
							<span class="formlabel textColor">@Model.Name</span>
						</div>

						<div class="field-container">
							<span class="formlabel">@LangResources["Patient_Label_Sex"]</span>
							<span class="formlabel textColor">@(Model.Gender == "M" ? "Male" : "Female")</span>
						</div>
					</div>

					<div style="display: flex; margin-bottom: 1.5vw;">
						<div class="field-container quaterSize">
							<span class="formlabel">@LangResources["Patient_Label_RegistrationNo"]</span>
							<span class="formlabel textColor">@Model.RegistrationNo</span>
						</div>
					</div>
				</div>

			</div>

			<div class="containerBackground2" style="width: 23vw; padding: 0.7vw; padding-left: 1.5vw; border-top-left-radius: 0.5vw; border-top-right-radius: 0.5vw;">
				<span class="formlabel" style="margin-bottom: 0 !important;">@LangResources["Patient_Title_AdditionalInformation"]</span>
			</div>
			<div class="containerBorder textColor" style="color: darkgray; width: 23vw; border-style: solid; border-bottom-left-radius: 0.5vw; border-bottom-right-radius: 0.5vw; padding: 2vw; padding-left: 0.5vw; padding-right: 0.5vw; padding-bottom: 0.5vw; margin-bottom: 2vw;">

				<div style="display: flex; margin-bottom: 1.5vw;">
					<div class="field-container quaterSize" style="display: flex; align-items: center;">
						<button class="btn btn-lg btn-primary" data-bs-toggle="modal" data-bs-target="#healthCardModal" style="width: 5vw; height: 4vw; font-size: 2vw; display: flex; justify-content: center;  align-items: center;">
							<i class="fa-solid fa-notes-medical"></i>
						</button>
						<span class="formlabel textColor" style="text-wrap: nowrap;">@LangResources["Patient_Label_HealthCard"]</span>
					</div>
					<div class="field-container quaterSize" style="display: flex; align-items: center;">
						<button class="btn btn-lg btn-primary" onclick="window.location = '/Patients/TreatmentPlan/@ViewBag.PatientID/@ViewData["PetName"]';" style="width: 5vw; height: 4vw; font-size: 2vw; display: flex; justify-content: center;  align-items: center;">
							<i class="fa-regular fa-hospital"></i>
						</button>
						<span class="formlabel textColor" style="text-wrap: nowrap;">@LangResources["Patient_Label_TreatmentPlan"]</span>
					</div>
				</div>

				<div style="display: flex; margin-bottom: 1.5vw;">
					<div class="field-container quaterSize" style="display: flex; align-items: center;">
						<button class="btn btn-lg btn-primary" onclick="window.location = '/Patients/InvoiceBilling/@ViewBag.PatientID/@ViewData["PetName"]';" style="width: 5vw; height: 4vw; font-size: 2vw; display: flex; justify-content: center;  align-items: center;">
							<i class="fa-solid fa-receipt"></i>
						</button>
						<span class="formlabel textColor" style="text-wrap: nowrap;">@LangResources["Patient_Label_InvoiceBilling"]</span>
					</div>
					<div class="field-container quaterSize" style="display: flex; align-items: center;">
						<button class="btn btn-lg btn-primary" style="width: 5vw; height: 4vw; font-size: 2vw; display: flex; justify-content: center;  align-items: center;">
							<i class="fa-solid fa-flask-vial"></i>
						</button>
						<span class="formlabel textColor" style="text-wrap: nowrap;">@LangResources["Patient_Label_TestManagement"]</span>
					</div>
				</div>




			</div>

			<div class="containerBackground2" style="width: 23vw; padding: 0.7vw; padding-left: 1.5vw; border-top-left-radius: 0.5vw; border-top-right-radius: 0.5vw;">
				<span class="formlabel" style="margin-bottom: 0 !important;">@LangResources["Patient_Title_UpcomingAppointment"]</span>
			</div>
			<div class="containerBorder" style="background-color: #c8dcfc; color: darkgray; width: 23vw; border-style: none; border-bottom-left-radius: 0.5vw; border-bottom-right-radius: 0.5vw; padding: 2vw; padding-left: 0.5vw; padding-right: 0.5vw; padding-bottom: 0.4vw;">

				<div style="display: flex; margin-bottom: 1.5vw;">
					<div class="field-container quaterSize">
						<span class="formlabel">@LangResources["Patient_Label_Date"]</span>
						<span class="formlabel" style="color: black;">10/4/2024</span>
					</div>

					<div class="field-container quaterSize">
						<span class="formlabel">@LangResources["Patient_Label_Time"]</span>
						<span class="formlabel" style="color: black;">13:00</span>
					</div>
				</div>


				<div style="display: flex; margin-bottom: 1.5vw;">
					<div class="field-container quaterSize">
						<span class="formlabel">@LangResources["Patient_Label_Pet"]</span>
						<span class="formlabel" style="color: black;">Simba</span>
					</div>

					<div class="field-container quaterSize">
						<span class="formlabel">@LangResources["Patient_Label_Service"]</span>
						<span class="formlabel" style="color: black;">General Check Up</span>
					</div>
				</div>


				<div style="display: flex; margin-bottom: 1.5vw;">
					<div class="field-container quaterSize">
						<span class="formlabel">@LangResources["Patient_Label_Doctor"]</span>
						<span class="formlabel" style="color: black;">Dr. Kim Soo Jun</span>
					</div>
				</div>

			</div>
		</div>
	</div>
</div>

<!-- Modal -->
<div class="modal fade" id="healthCardModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true" style="--bs-modal-width: unset; margin: 2vw auto;">

	<style>
		.hideContainer {
			display: none !important;
		}

		@@media print {
			/* All your print styles go here */
			.printFont{
				font-size: 2vw !important;
			}

			.printImg {
				width: 10vw !important;
			}
		}

		.modal-content-custom {
			border: 0.1vw solid !important;
			padding: 1vw;
		}


	</style>

	<div class="modal-dialog" style="margin: 0 auto; width: fit-content;">
		<div class="modal-content">
			<div class="modal-header" style="display: flex; justify-content: flex-end; --bs-modal-header-border-color: none; padding-bottom: 0;">
				<button type="button" onclick="downloadHealthCard();" style="margin-right: 1vw; display: flex; justify-content: center;  align-items: center; font-size: 1vw; width: 1vw;" class="btn btn-lg btn-primary" data-bs-dismiss="modal">
					<i class="fa-solid fa-download"></i>
				</button>
				<button type="button" onclick="printHealthCard();" style="display: flex; justify-content: center;  align-items: center; font-size: 1vw; width: 1vw;" class="btn btn-lg btn-primary" data-bs-dismiss="modal"><i class="fa-solid fa-print"></i></button>
			</div>
			<div class="modal-body" style="display: flex;">
				<div style="margin: 0 1vw;">
					<img class="printImg" src="~/images/Cat profile image.png" style="width: 6vw; margin-bottom: 2vw;" />

					<div style="display: flex; flex-direction: column; margin: 1vw 0;">
						<span class="printFont" style="color: darkgray; font-size: 1vw;">@LangResources["Patient_Label_PetName"]</span>
						<span class="printFont" style="color: black; font-size: 1vw;">@ViewData["PetName"]</span>
					</div>

					<div style="display: flex; flex-direction: column; margin: 1vw 0;">
						<span class="printFont" style="color: darkgray; font-size: 1vw;">@LangResources["Patient_Label_RegistrationNo"]:</span>
						<span class="printFont" style="color: black; font-size: 1vw;">@Model.RegistrationNo</span>
					</div>
				</div>

				<hr style="border: 0.1vw solid black; margin: 0 1vw;">

				<div>
					<div style="margin-bottom: 2vw; padding: 1vw;">
						<span class="printFont" style="font-weight: bold; font-size: 1vw; padding: 0 2vw;">@LangResources["Patient_Title_VaccinationTreatmentHistory"]</span>

						<table class="printFont" style="font-size: 1vw; margin-top: 1vw;">
							<tr>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_Date"]</th>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_VaccinationTreatment"]</th>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_Name"]</th>
							</tr>
							<tr>
								<td style="padding: 0 2vw;">01/09/2023</td>
								<td style="padding: 0 2vw;">Rabbies Vaccinations</td>
								<td style="padding: 0 2vw;">Defensor 1 - Rabies</td>
							</tr>
							<tr>
								<td style="padding: 0 2vw;">01/09/2023</td>
								<td style="padding: 0 2vw;">Rabbies Vaccinations</td>
								<td style="padding: 0 2vw;">Defensor 1 - Rabies</td>
							</tr>
							<tr>
								<td style="padding: 0 2vw;">01/09/2023</td>
								<td style="padding: 0 2vw;">Rabbies Vaccinations</td>
								<td style="padding: 0 2vw;">Defensor 1 - Rabies</td>
							</tr>
							<tr>
								<td style="padding: 0 2vw;">01/09/2023</td>
								<td style="padding: 0 2vw;">Rabbies Vaccinations</td>
								<td style="padding: 0 2vw;">Defensor 1 - Rabies</td>
							</tr>
						</table>
					</div>

					<div style="margin: 2vw 0; padding: 1vw;">
						<span class="printFont" style="font-weight: bold; font-size: 1vw; padding: 0 2vw;">@LangResources["Patient_Title_MedicationHistory"]</span>

						<table class="printFont" style="font-size: 1vw; margin-top: 1vw;">
							<tr>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_Date"]</th>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_MedicationName"]</th>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_Status"]</th>
							</tr>
							<tr>
								<td style="padding: 0 2vw;">01/09/2023</td>
								<td style="padding: 0 2vw;">Prednisalone Suspension 5mg|10ml</td>
								<td style="padding: 0 2vw;">Active</td>
							</tr>
						</table>
					</div>

					<div style="margin: 2vw 0; background-color: whitesmoke; padding: 1vw; border-radius: 0.5vw;">
						<span class="printFont" style="font-weight: bold; font-size: 1vw; padding: 0 2vw;">@LangResources["Patient_Title_UpcomingVaccinationTreatment"]</span>

						<table class="printFont" style="font-size: 1vw; margin-top: 1vw;">
							<tr>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_Date"]</th>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_VaccinationTreatment"]</th>
								<th style="color: darkgray; padding: 0 2vw;">@LangResources["Patient_Label_Name"]</th>
							</tr>
							<tr>
								<td style="padding: 0 2vw;">01/09/2023</td>
								<td style="padding: 0 2vw;">Rabbies Vaccinations</td>
								<td style="padding: 0 2vw;">Defensor 1 - Rabies</td>
							</tr>
						</table>
					</div>

				</div>
			</div>
		</div>
	</div>

</div>

<script>

	function downloadHealthCard() {
		var clone = document.getElementById("healthCardModal").cloneNode(true);
		clone.querySelector(".modal-header").classList.toggle("hideContainer");
		clone.querySelector(".modal-content").classList.toggle("modal-content-custom");
		var element = clone.querySelector(".modal-dialog");

		var opt = {
			margin: [1, 0],
			filename: '@ViewData["PetName"] - Health Card.pdf',
			image: { type: 'jpeg', quality: 0.98 },
			html2canvas: { scale: 2 },
			jsPDF: { unit: 'in', format: 'letter', orientation: 'portrait' }
		};

		html2pdf().set(opt).from(element).save();
	}

	function printHealthCard() {
		var iframe = document.createElement("iframe"); // create the element
		document.body.appendChild(iframe);  // insert the element to the DOM

		var clone = document.getElementById("healthCardModal").cloneNode(true);
		clone.querySelector(".modal-header").classList.toggle("hideContainer");
		clone.querySelector(".modal-content").classList.toggle("modal-content-custom");

		var input = clone.innerHTML;

		iframe.contentWindow.document.write(input); // write the HTML to be printed
		iframe.contentWindow.print();  // print it
		document.body.removeChild(iframe); // remove the iframe from the DOM
	}

	document.querySelector('#addSelections').addEventListener('click', function (event) {
		if (this.classList.contains("disable")) { event.stopPropagation(); }
		else{
			var treatmentNameElement = document.getElementById("treatmentPlanContainer");
			var template = document.getElementById("treatmentPlanTemplate");
			const clone = template.content.cloneNode(true);
			treatmentNameElement.appendChild(clone);

			var treatmentNameElement = document.getElementById("treatmentPlanName");
			var checkboxes = document.getElementsByClassName("treatmentPlanOption");
			var selectedCboxes = Array.prototype.slice.call(checkboxes).filter(ch => ch.checked == true);

			for (let i = 0; i < selectedCboxes.length; i++) {
				treatmentNameElement.innerHTML = selectedCboxes[i].value;
				getServiceListByPlan(selectedCboxes[i].getAttribute('data-id'));
				getProductListByPlan(selectedCboxes[i].getAttribute('data-id'));
			}

			// cloneElement(true, "serviceTemplate", "serviceList", "serviceID", 0, "serviceName", "Surgery", "servicePrice", "500", false, 0, 0);
			// cloneElement(true, "productTemplate", "productList", "productID", 0, "productName", "Actogain 45 plus", "productPrice", "100", true, 10, "100");

			var dropdownElement = document.getElementById("treatmentPlanList");
			dropdownElement.classList.toggle("hideContainer");

			var element = document.getElementById("treatmentPlanContainer");
			element.classList.toggle("hideContainer");
		}
	});

	document.querySelector('#clearFilter').addEventListener('click', function (event) {
		event.stopPropagation();

		var checkboxes = document.getElementsByClassName("treatmentPlanOption");
		var selectedCboxes = Array.prototype.slice.call(checkboxes).filter(ch => ch.checked == true);

		for (let i = 0; i < selectedCboxes.length; i++) {
			selectedCboxes[i].checked = false;
		}

		document.getElementById("searchTreatment").value = "";
		$('#searchTreatment').keyup();

		var addSelections = document.getElementById("addSelections");
		if (!addSelections.classList.contains("disable")) { addSelections.classList.toggle("disable"); }

	});

	var treatments = document.querySelectorAll('.form-check');

	for (let i = 0; i < treatments.length; i++) {
		treatments[i].addEventListener('click', function (event) {
			event.stopPropagation();

			disabledFilter = true;

			var checkboxes = document.getElementsByClassName("treatmentPlanOption");
			var selectedCboxes = Array.prototype.slice.call(checkboxes).filter(ch => ch.checked == true);

			if (selectedCboxes.length > 0) {
				disabledFilter = false;
			}

			var addSelections = document.getElementById("addSelections");
			if (disabledFilter) {
				if (!addSelections.classList.contains("disable")) { addSelections.classList.toggle("disable"); }
			}
			else {
				if (addSelections.classList.contains("disable")) { addSelections.classList.toggle("disable"); }
			}
			
		});
	}

	function changeTab(e){
		var allTab = document.querySelectorAll(".tabButton");

		for (let i = 0; i < allTab.length; i++) {
			if (allTab[i].classList.contains("currentTab")){ allTab[i].classList.toggle("currentTab"); }
			if (allTab[i] == e) { allTab[i].classList.toggle("currentTab"); }
		}
	}

	function filterTreatment(value) {
		const filter = value.value.toUpperCase();

		const a = document.querySelectorAll(".treatmentPlanOption");

		for (let i = 0; i < a.length; i++) {
			var treatmentValue = a[i].value;
			if (treatmentValue.toUpperCase().indexOf(filter) > -1) {
				a[i].parentElement.style.display = "";
			} else {
				a[i].parentElement.style.display = "none";
			}
		}
	}

	function cloneElement(edit, templateId, elementId, idElement, id, nameElement, name, priceElement, price, productGroup, units, originalPrice) {
		const template = document.getElementById(templateId);
		const element = document.getElementById(elementId);
		var allElement = element.querySelectorAll("tr");
		allElement[allElement.length - 1].remove();
		const clone = template.content.cloneNode(true);
		var notExisted = true;
		var totalCost = 0;

		// clone.querySelector("." + idElement).innerHTML = id;
		clone.querySelector("." + nameElement).innerHTML = name;
		clone.querySelector("." + priceElement).innerHTML = "$" + price;

		if (productGroup) {
			clone.querySelector(".productOriginalPrice").innerHTML = originalPrice;
			clone.querySelector(".productUnit").innerHTML = units;
		}

		element.appendChild(clone);

		var priceElements = element.querySelectorAll("." + priceElement);

		for (let i = 0; i < priceElements.length; i++) {
			totalCost += parseInt(priceElements[i].innerHTML.replace("$", ""));
		}

		element.querySelector(".totalCost").innerHTML = "$" + totalCost;

		calculateTotal();
	}

	function calculateTotal() {
		var totalElement = document.getElementById("totalCost");
		var taxElement = document.getElementById("tax");
		var grandTotalElement = document.getElementById("grandTotal");
		var totalCostList = document.querySelectorAll(".totalCost");
		var totalCost = 0;
		var tax = 0;

		for (let i = 0; i < totalCostList.length; i++) {
			totalCost += parseInt(totalCostList[i].innerHTML.replace("$", ""));
		}

		tax = totalCost * (6 / 100);

		totalElement.innerHTML = "$" + totalCost;
		taxElement.innerHTML = "$" + tax;
		grandTotalElement.innerHTML = "$" + (totalCost + tax);
	}

	function removeTreatmentPlan(element) {
		element.parentElement.parentElement.parentElement.remove();

		var dropdownElement = document.getElementById("treatmentPlanList");
		dropdownElement.classList.toggle("hideContainer");

		var element = document.getElementById("treatmentPlanContainer");
		element.classList.toggle("hideContainer");
	}

	function getServiceListByPlan(id) {
		fetch('/PatientServices/GetTreatmentPlanServicesList?planID=' + id)
			.then(response => {
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				return response.json();
			})
			.then(data => {
				for (let i = 0; i < data.length; i++) {
					cloneElement(true, "serviceTemplate", "serviceList", "serviceID", data[i].ServiceID, "serviceName", data[i].ServiceName, "servicePrice", data[i].Price, false, 0, 0);
				}
			})
			.catch(error => {
				console.error('There was a problem with the fetch operation:', error);
			});
	}

	function getProductListByPlan(id) {
		fetch('/PatientServices/GetTreatmentPlanProductsList?planID=' + id)
			.then(response => {
				if (!response.ok) {
					throw new Error('Network response was not ok');
				}
				return response.json();
			})
			.then(data => {

				for (let i = 0; i < data.length; i++) {
					cloneElement(true, "productTemplate", "productList", "productID", data[i].ProductID, "productName", data[i].ProductName, "productPrice", data[i].TotalPrice, true, data[i].Units, data[i].PricePerQty);
				}
				calculateTotal();
			})
			.catch(error => {
				console.error('There was a problem with the fetch operation:', error);
			});
	}
</script>